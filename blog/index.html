<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">Blog | Yazi</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://yazi-rs.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://yazi-rs.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://yazi-rs.github.io/blog"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="Blog | Yazi"><meta data-rh="true" name="description" content="Blog"><meta data-rh="true" property="og:description" content="Blog"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/img/logo.png"><link data-rh="true" rel="canonical" href="https://yazi-rs.github.io/blog"><link data-rh="true" rel="alternate" href="https://yazi-rs.github.io/blog" hreflang="en"><link data-rh="true" rel="alternate" href="https://yazi-rs.github.io/blog" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Yazi RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Yazi Atom Feed"><link rel="stylesheet" href="/assets/css/styles.9262c60b.css">
<script src="/assets/js/runtime~main.e249d2bd.js" defer="defer"></script>
<script src="/assets/js/main.b8814596.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_NOja" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Yazi file manager" class="themedComponent_LOPD themedComponent--light_yK2g"><img src="/img/logo.png" alt="Yazi file manager" class="themedComponent_LOPD themedComponent--dark_Fl0Q"></div><b class="navbar__title text--truncate">Yazi</b></a><a class="navbar__item navbar__link" href="/docs/installation">Docs</a><a class="navbar__item navbar__link" href="/features">Features</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/sxyazi/yazi" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_bhIR"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_YTaE colorModeToggle_qy8v"><button class="clean-btn toggleButton_umoe toggleButtonDisabled_E0Um" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_gbvh"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_P_XK"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_h5OB"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_vKin"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_JF8t thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_nuMD margin-bottom--md">Recent posts</div><ul class="sidebarItemList_GRmY clean-list"><li class="sidebarItem_xZAI"><a class="sidebarItemLink_jEvr" href="/blog/why-is-yazi-fast">Why is Yazi fast?</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="This article assumes that you have already used Yazi and are familiar with most of its features."><header><h2 class="title_ZFC9" itemprop="headline"><a itemprop="url" href="/blog/why-is-yazi-fast">Why is Yazi fast?</a></h2><div class="container_SMF5 margin-vert--md"><time datetime="2023-10-29T00:00:00.000Z" itemprop="datePublished">October 29, 2023</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_hUKy"><div class="avatar margin-bottom--sm"><a href="https://github.com/sxyazi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/sxyazi.png" alt="三咲雅 · Misaki Masa" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/sxyazi" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">三咲雅 · Misaki Masa</span></a></div><small class="avatar__subtitle" itemprop="description">Creator of Yazi</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>This article assumes that you have already used Yazi and are familiar with most of its features.</p>
<p>Yazi has undergone significant optimizations to enhance user experience. It is designed entirely as an async program, handling all time-consuming tasks (I/O and CPU) as async tasks in a non-blocking, event-driven manner.</p>
<h2 class="anchor anchorWithStickyNavbar_k3fG" id="tokio">Tokio<a href="#tokio" class="hash-link" aria-label="Direct link to Tokio" title="Direct link to Tokio">​</a></h2>
<p>Internally, Yazi uses Tokio as its async runtime: hold on! Tokio&#x27;s async may not be &quot;truly async&quot; as you might perceive it!</p>
<p>Uh, okay. From an application-layer perspective, it indeed is async; however, from a system-level view, there are possibly better solutions.</p>
<p>But! This is not the current performance bottleneck for Yazi. Considering Yazi is a TUI app, unlike CLI programs like <code>ls</code> and <code>exa</code> that need to output all files immediately, Yazi has more optimization opportunities at the application-layer:</p>
<ul>
<li>For large directories (e.g., 100,000 files), Yazi uses <a href="https://github.com/sxyazi/yazi/pull/117" target="_blank" rel="noopener noreferrer">chunked loading</a>, which is unmatched by <code>ls</code> and <code>exa</code> since they must load everything at once.</li>
<li>Yazi also preloads directory file lists in the background, an optimization that <code>ls</code> and <code>exa</code> do not possess.</li>
</ul>
<p>I must express my gratitude to Tokio for providing an excellent and convenient way to realize these application-layer optimizations.</p>
<p>I believe that the benefits brought by these application-level optimizations are more noticeable compared to switching to solutions like <code>io_uring</code>. But I remain open to this and welcome constructive PR.</p>
<p>Here is a relevant discussion on Reddit: <a href="https://www.reddit.com/r/rust/comments/16fxr58/comment/k066gmh/" target="_blank" rel="noopener noreferrer">reddit.com/r/rust/comments/16fxr58/comment/k066gmh</a></p>
<h2 class="anchor anchorWithStickyNavbar_k3fG" id="pre-caching">Pre-Caching<a href="#pre-caching" class="hash-link" aria-label="Direct link to Pre-Caching" title="Direct link to Pre-Caching">​</a></h2>
<p>Yazi provides pre-caching mechanisms for the following data:</p>
<ul>
<li>Mimetype: The baseline. Yazi uses the file&#x27;s mimetype as a reference for tasks such as opening, previewing, and style rendering, and internally utilizes <code>file(1)</code> to obtain the file&#x27;s mimetype.</li>
<li>Image: To accelerate image previews, Yazi employs a 2-pass process for image files. The first pass is preprocessing, which downscales the image based on user-set max_width/max_height and generates a compressed lossy image as a cache file, significantly reducing file size. The second pass occurs when the user actually switches to the file and downscales it again to fit the terminal size.</li>
<li>Video: To speed up video previews, Yazi pre-converts them into images and goes through the first pass of image processing. When the user needs to display the video, it undergoes the same second pass.</li>
<li>PDF: Similar to video.</li>
<li>Directory size: Yazi lazily calculates the directory size only when the user sets sorting by file size, as it is a time-consuming operation.</li>
</ul>
<p>Note: Except for size, all of these are scoped, meaning that when you are on the first page, only the first few files will be pre-cached.</p>
<p>For example, if your directory has 1000 files, your terminal height is 10, and you are on the second page, only files 11 to 20 will be processed. This greatly saves resources.</p>
<h2 class="anchor anchorWithStickyNavbar_k3fG" id="discardable-tasks">Discardable Tasks<a href="#discardable-tasks" class="hash-link" aria-label="Direct link to Discardable Tasks" title="Direct link to Discardable Tasks">​</a></h2>
<p>Every preview task is discardable. When you navigate quickly between files and the previous file&#x27;s triggered preview task is still not finished, it will be discarded directly, initiating a new task.</p>
<p>This promotes resource utilization. For I/O tasks like loading directory lists, Tokio&#x27;s <code>abort</code> is used; for CPU tasks like code highlighting, an <code>Atomic</code> is used to record a <code>ticket</code>, and it checks if the value changes on each line code highlight. If it changes, it indicates that the current context has changed, and the entire highlighting task is discarded.</p>
<h2 class="anchor anchorWithStickyNavbar_k3fG" id="code-highlighting">Code Highlighting<a href="#code-highlighting" class="hash-link" aria-label="Direct link to Code Highlighting" title="Direct link to Code Highlighting">​</a></h2>
<p>Yazi has built-in code highlighting and keeps it to a minimum for all text files: if your terminal height is 10, only the first 10 lines of the file are read and highlighted.</p>
<p>Other file managers that rely on external programs like <code>bat</code> need to wait for <code>bat</code> to finish highlighting the <em>entire file</em> before displaying only the first 10 lines.</p>
<p>In cases like JSON that require external program <code>jq</code>, Yazi kills <code>jq</code> directly after reading the first 10 lines to avoid unnecessary resource consumption.</p>
<p>Since code highlighting is a CPU-intensive task, it is distributed among multiple blocking threads, managed through Tokio&#x27;s spawn_blocking, and is also discardable.</p>
<h2 class="anchor anchorWithStickyNavbar_k3fG" id="image-preview">Image Preview<a href="#image-preview" class="hash-link" aria-label="Direct link to Image Preview" title="Direct link to Image Preview">​</a></h2>
<p>Yazi not only has built-in code highlighting but also includes image encoding and downscaling - there is likely nothing faster than having it directly built-in. It is also distributed among multiple threads and is discardable.</p>
<p>Besides being fast, Yazi&#x27;s built-in Terminal graphics protocol, Inline images protocol, and Sixel graphics format allow Yazi to finely control when to display or hide images.</p>
<p>This ensures that in Yazi, there won&#x27;t be issues, like images stacking on top of each other, or image escape code breaking the entire screen, when quickly navigating through images, as <code>stdout</code> is locked while outputting these escape codes. This locking happens after all image data is prepared, so it has no impact on performance.</p>
<h2 class="anchor anchorWithStickyNavbar_k3fG" id="async-task-scheduling">Async Task Scheduling<a href="#async-task-scheduling" class="hash-link" aria-label="Direct link to Async Task Scheduling" title="Direct link to Async Task Scheduling">​</a></h2>
<p>In Yazi, tasks are automatically prioritized based on their severity. Yazi categorizes tasks into two types:</p>
<ul>
<li>Macro tasks: Large and heavy tasks, such as copying large files, typically taking a long time to complete.</li>
<li>Micro tasks: Small and urgent tasks, such as fetching file mimetype, pre-caching images, calculating directory size, and so on.</li>
</ul>
<p>This is similar to having big and small cores in a CPU; when the big cores are idle, they help with the micro tasks. Yazi defaults to starting 5 micro workers and 10 macro workers, and these numbers can be configured by the user!</p>
<p>For complex tasks like file copying, a combination of micro and macro approaches is employed. Micro is used to recursively gather a list of all files to be copied, allowing users to see the number of tasks and their sizes in advance. Macro, on the other hand, handles the actual copying process.</p>
<p>The advantage of task scheduling extends beyond providing ample concurrency for I/O and CPU resources; it also indirectly mitigates the depletion of system resources (such as file handles and CPU) due to sudden task surges.</p>
<h2 class="anchor anchorWithStickyNavbar_k3fG" id="todo">TODO<a href="#todo" class="hash-link" aria-label="Direct link to TODO" title="Direct link to TODO">​</a></h2>
<p>I&#x27;ll find time to continue writing.</p></div><footer class="row docusaurus-mt-lg"></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/installation">Docs</a></li><li class="footer__item"><a class="footer__link-item" href="/features">Features</a></li><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/qfADduSdJu" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord (English mainly)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_bhIR"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://t.me/yazi_rs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram (Chinese mainly)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_bhIR"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/sxyazi/yazi" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_bhIR"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Yazi. Built with ❤️️.</div></div></div></footer></div>
</body>
</html>